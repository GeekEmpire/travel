<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>路线详情</title>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/common.css">
    <link rel="stylesheet" type="text/css" href="css/route-detail.css">
    <script src="js/vue.js"></script>
</head>

<body>
<!--引入头部-->
<div id="header"></div>
    <!-- 详情 start -->   
    <div class="wrap" id="detail">
        <div class="bread_box" style="font-size: 28px">
            <a href="/"></a>
            <span> &gt;</span>
            <a>添加新路线</a>
            <span> &gt;</span>
            <a href="#">{{route.rname}}</a>
        </div>
        <form id="addRoute">
            <div class="prosum_box" style="margin-top: 20px">
                <dl class="prosum_left">
                    <dt>
                        <button id="load" @click="loadImg()" type="button">
                            <img alt="" class="big_img" id="big_img" :src="bigimg" >
                            <input type="file" id="load_xls" style="display:none"
                                   accept="image/gif,image/jpeg,image/jpg,image/png" @change ="uploadFile($event)">
                        </button>
                    </dt>
                    <dd id="dd">
                        <a class="up_img up_img_disable"></a>
                        <button id="loadsmall" @click="loadSImg()" type="button">
                            <a title="" class="little_img" data-bigpic="" v-for="(item,i) in simages">
                                <img :src="item">
                            </a>
                            <input type="file" id="load_files" style="display:none" multiple="multiple"
                                   accept="image/gif,image/jpeg,image/jpg,image/png" @change ="uploadFiles($event)">

                        </button>
                        <a class="down_img down_img_disable" style="margin-bottom: 0;"></a>
                    </dd>
                </dl>
                <div class="prosum_right">
                    <div class="form-group" style="margin-right: 20px">
                        <label for="routeName">路线名</label>
                        <input type="text" name="rname" class="form-control" id="routeName" placeholder="请输入路线名">
                    </div>
                    <div class="form-group" style="margin-right: 20px" >
                        <label for="routeIntroduce">路线介绍</label>
                        <textarea class="form-control" id="routeIntroduce" name="routeIntroduce" placeholder="请输入路线介绍"></textarea>
                    </div>
                    <div class="pros_other">
                        <p >
                            发布者(管理员)<span ></span>  :
                            <span id="sname" >
                            {{seller.sname}}
                        </span>
                        </p>
                        <p >
                            <span>联系电话 :</span>
                            <span id="consphone">{{seller.consphone}}</span>
                        </p>
                        <p>地址 ：
                            <span id="address">{{seller.address}}</span>
                        </p>
                    </div>
                    <div class="pros_price">
                        <p class="price">
                            <span style="font-size: 18px;margin-right: 5px">花费</span>
                            <strong id="price">
                                <input name="price" style="height: 30px;padding: 5px 10px;font-size: 16px">
                            </strong>
                            <span style="margin-left: 10px">起</span></p>
                    </div>
                </div>
            </div>
            <div class="you_need_konw">
                <span>详情</span>
                <div style="line-height: 35px;margin-top: 5px">
                    <textarea style="width: 100%;height: 120px" name="deatil"></textarea>
                </div>
                <input class="btn btn-success"  @click="addRoute" style="width: 150px;margin-left: 46%" type="button" value="提交" >
            </div>
        </form>
    </div>
    <!-- 详情 end -->

    <!--引入头部-->
    <div id="footer"></div>
        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="js/jquery-3.3.1.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    <!--导入布局js，共享header和footer-->
    <script src="js/getParameter.js"></script>
    <script>

    var detail = new Vue({
        el:"#detail",
        data:{
            rid: null,
            uid: null,
            area: "浙江",
            flag: false,
            route:{
                user:{},
                seller: {}
            },
            seller:{

            },
            ddstr: "",
            bigimg: 'images/main.jpg',
            bfile: null,
            simages: [
                "images/mainfu.jpg"
            ],
            sfiles: [

            ]
        },
        methods:{
            loadImg(){
                $("#load_xls").click();
            },
            uploadFile(e){
                var that = this;
                /*创建文件读取对象*/
                var reader=new FileReader();
                /*文件存储在file表单元素的files属性中，它是一个数组*/
                var file=e.target.files[0];
                if(file) {
                    this.bfile = file;
                    console.log(this.bfile)
                    reader.readAsDataURL(file)
                    reader.onload= function(e){
                        // 这里的this 指向reader
                        that.bigimg = e.target.result
                    }
                }
            },
            loadSImg(){
                $("#load_files").click();
            },
            uploadFiles(e){
                var that = this;
                /*创建文件读取对象*/
                /*文件存储在file表单元素的files属性中，它是一个数组*/
                var files=e.target.files;
                console.log(files)
                if(files) {
                    for(var i =0;i<files.length;i++){
                        that.sfiles[i] = files[i];
                        var reader=new FileReader();
                        var simages = [];
                        reader.readAsDataURL(files[i]);
                        reader.onload = function (e) {
                            simages.push(e.target.result);
                        }
                        that.simages = simages;
                    }
                    console.log(this.simages)
                }
            },
            goImg(){
                //焦点图效果
                //点击图片切换图片
                $('.little_img').on('mousemove', function() {
                    $('.little_img').removeClass('cur_img');
                    var big_pic = $(this).data('bigpic');
                    $('.big_img').attr('src', big_pic);
                    $(this).addClass('cur_img');
                });
                //上下切换
                var picindex = 0;
                var nextindex = 4;
                $('.down_img').on('click',function(){
                    var num = $('.little_img').length;
                    if((nextindex + 1) <= num){
                        $('.little_img:eq('+picindex+')').hide();
                        $('.little_img:eq('+nextindex+')').show();
                        picindex = picindex + 1;
                        nextindex = nextindex + 1;
                    }
                });
                $('.up_img').on('click',function(){
                    var num = $('.little_img').length;
                    if(picindex > 0){
                        $('.little_img:eq('+(nextindex-1)+')').hide();
                        $('.little_img:eq('+(picindex-1)+')').show();
                        picindex = picindex - 1;
                        nextindex = nextindex - 1;
                    }
                });
            },
            findSeller(){
                var that = this;
                $.post("seller/findOne",{sid:1},function (data) {
                    if(data!=null){
                        that.seller = data;
                    }
                });
            },
            //自动轮播方法
            auto_play() {
                var cur_index = $('.prosum_left dd').find('a.cur_img').index();
                cur_index = cur_index - 1;
                var num = $('.little_img').length;
                var max_index = 3;
                if ((num - 1) < 3) {
                    max_index = num - 1;
                }
                if (cur_index < max_index) {
                    var next_index = cur_index + 1;
                    var big_pic = $('.little_img:eq(' + next_index + ')').data('bigpic');
                    $('.little_img').removeClass('cur_img');
                    $('.little_img:eq(' + next_index + ')').addClass('cur_img');
                    $('.big_img').attr('src', big_pic);
                } else {
                    var big_pic = $('.little_img:eq(0)').data('bigpic');
                    $('.little_img').removeClass('cur_img');
                    $('.little_img:eq(0)').addClass('cur_img');
                    $('.big_img').attr('src', big_pic);
                }
            },
            addRoute(){
                var data = $('#addRoute').serialize();
                $.post("route/add", data,function (data) {
                    if(data!=null){
                        alert("添加成功")
                        location.href="ht_route_detail.html?rid="+data.rid;
                    }else{
                        alert("添加失败")
                    }
                });
            },

        },
        created: function () {
            this.goImg();
            // this.auto_play();
            // this.findOne();
            this.findSeller();
        }
    })
    </script>
</body>

</html>